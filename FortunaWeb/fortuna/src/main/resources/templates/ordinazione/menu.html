<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head> 
    <title>Fortuna: Ordinazione</title> 
    <!--/*/ <th:block th:insert="fragments/general.html :: headerfiles">
    </th:block> /*/-->
</head>
<body>
    <header th:insert="fragments/general.html :: header"> </header>
    <div class="w3-center w3-main w3-content" style="max-width:1200px">
        <h1>Ordinazione</h1>
        <p th:text="'Ordinazione scelta: ' + ${session.tipoOrdine}" />

        <h2>Scegli i prodotti:</h2>

        <div class="w3-row-padding">
            <div class="w3-twothird" id="menu">
                <h1>Menù</h1>
                <form action="#" th:action="@{/ordine-prodotti}" method="POST">
                    <table class="w3-table w3-striped">
                        <thead>
                            <tr>
                                <th>Numero</th>
                                <th>Nome</th>
                                <th>Prezzo</th>
                                <th>Descrizione</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody class="menu-body">
                            <tr th:each="prodotto : ${menu}" >
                                <td th:text="${prodotto.numero}">101</td>
                                <td th:text="${prodotto.nome}">Involtini Primavera</td>
                                <td th:text="${prodotto.prezzo + '€'}">1.50</td>
                                <td th:text="${prodotto.desc}">-</td>
                                <td>
                                    <button th:unless="${#sets.contains(prodottiDisabilitati, prodotto)}" 
                                        type="submit" name="add" th:value="${prodotto.numero}"
                                        class="w3-btn w3-ripple w3-red w3-round">Aggiungi</button>
                                    <span th:if="${#sets.contains(prodottiDisabilitati, prodotto)}">Non disponibile</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </form>
            </div>
    
            <div class="w3-third" id="carrello">
                <h1>Carrello</h1>
                <form action="#" th:action="@{/ordine-prodotti}" method="POST">
                    <table class="w3-table w3-striped">
                        <thead>
                            <tr>
                                <th>Numero</th>
                                <th>Nome</th>
                                <th>Prezzo</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td colspan="4">
                                <div class="carrello-body">
                                    <table>
                                        <tr th:each="prodotto : ${session.prodotti}">
                                            <td th:text="${prodotto.numero}">101</td>
                                            <td th:text="${prodotto.nome}">Involtini Primavera</td>
                                            <td th:text="${prodotto.prezzo + '€'}">1.50</td>
                                            <td><button type="submit" name="remove" th:value="${prodottoStat.index}"
                                                class="w3-btn w3-ripple w3-white w3-border w3-round">Rimuovi</button></td>
                                        </tr>
                                    </table>
                                </div>
                            </td></tr>
                            <tr>
                                <td colspan="3">Totale</td>
                                <td colspan="2" th:text="${totale}"></td>
                            </tr>
                        </tbody>
                    </table>  
                </form>
            </div>
        </div>
        <div class="w3-row-padding">
            <div id="conferma">
                <form action="#" th:action="${session.tipoOrdine == 'ORDINAZ_DOMICILIO'} ? @{/ordine-indirizzo} : @{/ordine-dati}" method="GET">
                    <button th:text="${session.tipoOrdine == 'ORDINAZ_DOMICILIO'} ? 'Scegli indirizzo' : 'Dati finali'"
                    class="w3-btn w3-ripple w3-amber w3-xlarge w3-round"></button>
                </form>
            </div>
        </div>
        <div class="w3-row-row-padding">
            <div id="sconti" class="w3-half">
                <h2>Sconti Disponibili</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Inizio</th>
                            <th>Fine</th>
                            <th>Quantità</th>
                            <th>Spesa Minima</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="sconto : ${scontiGen}">
                            <td th:text="${sconto.inizio.toLocalDate()}">2021-05-15</td>
                            <td th:text="${sconto.fine.toLocalDate()}">2021-07-15</td>
                            <td th:if="${sconto.quantita > 0}" th:text="${sconto.quantita + '€'}">1.50</td>
                            <td th:unless="${sconto.quantita > 0}" th:text="${sconto.quantitaPct * 100 + '%'}">25%</td>
                            <td th:text="${sconto.costoMinimo > 0 ? sconto.costoMinimo + '€' : ''}"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="sconti-prodotti" class="w3-half">
                <h2>Sconti Disponibili su Prodotti</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Inizio</th>
                            <th>Fine</th>
                            <th>Prodotto</th>
                            <th>Quantità</th>
                            <th>Spesa Minima</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="sconto : ${scontiProdotti}">
                            <span th:each="prodotto : ${sconto.perProdotti}">
                                <td th:text="${sconto.inizio.toLocalDate()}">2021-05-15</td>
                                <td th:text="${sconto.fine.toLocalDate()}">2021-07-15</td>
                                <td th:if="${sconto.quantita > 0}" th:text="${sconto.quantita + '€'}">1.50</td>
                                <td th:text="${prodotto.nome}">Involtini</td>
                                <td th:unless="${sconto.quantita > 0}" th:text="${sconto.quantitaPct * 100 + '%'}">25%</td>
                                <td th:text="${sconto.costoMinimo > 0 ? sconto.costoMinimo + '€' : ''}"></td>
                            </span>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div th:replace="fragments/general.html :: footer"></div> 
</body>
</html>